<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Snipping Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        iframe {
    width: 100%;
    height: 100%; /* or a specific height like 500px */
    border: none; /* removes extra spacing */
}
        #controls {
            margin-bottom: 10px;
        }
        button {
            padding: 8px 16px;
            margin-right: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #pdfViewer {
            position: relative;
            width: 800px;
            height: 600px;
            overflow: auto;
            border: 1px solid #ccc;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #pdfCanvas {
            display: block;
        }
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        #selectionRect {
            position: absolute;
            border: 2px solid limegreen;
            background-color: rgba(0, 255, 0, 0.1);
            pointer-events: none;
            display: none;
        }
    </style>
</head>
<body>
    <div id="controls">
        <input type="file" id="fileInput" accept="application/pdf">
        <button id="snipButton">Start Snipping</button>
    </div>
    <div id="pdfViewer">
        <canvas id="pdfCanvas"></canvas>
        <div id="overlay">
            <div id="selectionRect"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script>
        const fileInput = document.getElementById('fileInput');
        const pdfViewer = document.getElementById('pdfViewer');
        const pdfCanvas = document.getElementById('pdfCanvas');
        const selectionRect = document.getElementById('selectionRect');
        const snipButton = document.getElementById('snipButton');

        let pdfDoc = null;
        let pageNum = 1;
        let isSelecting = false;
        let startX, startY;

        // Load and render PDF
        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                const arrayBuffer = await file.arrayBuffer();
                pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                renderPage(pageNum);
            }
        });

        async function renderPage(num) {
            const page = await pdfDoc.getPage(num);
            const viewport = page.getViewport({ scale: 1.5 });
            pdfCanvas.width = viewport.width;
            pdfCanvas.height = viewport.height;
            const renderContext = {
                canvasContext: pdfCanvas.getContext('2d'),
                viewport: viewport
            };
            await page.render(renderContext).promise;
        }

        // Start selection
        snipButton.addEventListener('click', () => {
            if (!pdfDoc) {
                alert('Please upload a PDF first!');
                return;
            }
            isSelecting = true;
            snipButton.textContent = 'Snipping... (Click and drag)';
        });

        // Mouse down: Start drawing rectangle
        pdfViewer.addEventListener('mousedown', (e) => {
            if (!isSelecting) return;
            startX = e.clientX - pdfViewer.offsetLeft + pdfViewer.scrollLeft;
            startY = e.clientY - pdfViewer.offsetTop + pdfViewer.scrollTop;
            selectionRect.style.left = startX + 'px';
            selectionRect.style.top = startY + 'px';
            selectionRect.style.width = '0px';
            selectionRect.style.height = '0px';
            selectionRect.style.display = 'block';
        });

        // Mouse move: Update rectangle and auto-scroll
        pdfViewer.addEventListener('mousemove', (e) => {
            if (!isSelecting) return;
            const currentX = e.clientX - pdfViewer.offsetLeft + pdfViewer.scrollLeft;
            const currentY = e.clientY - pdfViewer.offsetTop + pdfViewer.scrollTop;
            const width = currentX - startX;
            const height = currentY - startY;

            // Update rectangle
            selectionRect.style.width = Math.abs(width) + 'px';
            selectionRect.style.height = Math.abs(height) + 'px';
            selectionRect.style.left = (width > 0 ? startX : currentX) + 'px';
            selectionRect.style.top = (height > 0 ? startY : currentY) + 'px';

            // Auto-scroll
            const margin = 50;
            if (e.clientY < pdfViewer.offsetTop + margin) {
                pdfViewer.scrollTop -= 10;
            } else if (e.clientY > pdfViewer.offsetTop + pdfViewer.clientHeight - margin) {
                pdfViewer.scrollTop += 10;
            }
        });

        // Mouse up: Finish selection
        pdfViewer.addEventListener('mouseup', () => {
            if (!isSelecting) return;
            isSelecting = false;
            snipButton.textContent = 'Start Snipping';
            selectionRect.style.display = 'none';

            // Here you can add code to save the selected area
            const rectX = parseInt(selectionRect.style.left);
            const rectY = parseInt(selectionRect.style.top);
            const rectWidth = parseInt(selectionRect.style.width);
            const rectHeight = parseInt(selectionRect.style.height);
            console.log('Selected area:', { x: rectX, y: rectY, width: rectWidth, height: rectHeight });
            // Example: You could use pdfCanvas.toDataURL() to export the selection
        });
    </script>
</body>
</html>