{% block content %}
<style>
  .cycle-beads-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 1rem;
  }

  .beads-circle {
    position: relative;
    width: 330px;
    height: 330px;
    border-radius: 50%;
    margin-bottom: 1rem;
  }

  .center-disc {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    background-color: black;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 15px 5px rgb(8, 175, 49);
    z-index: 1;
    animation: glow 5s infinite;
  }

  .needle {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 2px;
    height: 150px;
    transform: translate(-50%, -100%) rotate(0deg);
    transform-origin: bottom center;
    background: #333;
    transition: transform 0.3s ease-out;
    z-index: 2;
  }

  .bead {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 30px;
    height: 30px;
    margin: -15px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: transform 0.2s;
    font-size: 0.8rem;
    z-index: 0;
    user-select: none; /* Prevent text selection on mobile */
  }

  .bead.today { border: 2px solid #c2185b; }

  /* Phase colors */
  .bead.period     { background: #ff99cc; }
  .bead.follicular { background: #e0b3ff; }
  .bead.fertile    { background: #ffcc66; }
  .bead.ovulation  { background: #66ccff; }
  .bead.luteal     { background: #ccccff; }
  .bead.offcycle   { background: #eee; }

  .bead-info {
    text-align: center;
    font-family: sans-serif;
  }

  @keyframes glow {
    0% { box-shadow: 0 0 10px 5px rgba(205, 135, 15, 0.5); }
    10% { box-shadow: 0 0 15px 7px rgba(107, 15, 205, 0.6); }
    20% { box-shadow: 0 0 20px 10px rgba(125, 8, 84, 0.7); }
    30% { box-shadow: 0 0 25px 12px rgba(205, 15, 15, 0.8); }
    40% { box-shadow: 0 0 30px 15px rgba(205, 205, 15, 0.9); }
    45% { box-shadow: 0 0 25px 12px rgba(205, 135, 15, 0.8); }
    50% { box-shadow: 0 0 20px 10px rgba(26, 185, 206, 0.7); }
    60% { box-shadow: 0 0 15px 7px rgba(15, 205, 15, 0.6); }
    70% { box-shadow: 0 0 10px 5px rgba(151, 15, 205, 0.5); }
    80% { box-shadow: 0 0 5px 2px rgba(15, 205, 205, 0.94); }
    90% { box-shadow: 0 0 10px 5px rgba(129, 70, 11, 0.5); }
    100% { box-shadow: 0 0 10px 5px rgba(45, 3, 168, 0.5); }
  }

  /* Mobile Adjustments */
  @media (max-width: 768px) {
    .beads-circle {
      width: 90vw; /* Scale to viewport width */
      height: 90vw; /* Keep square */
      max-width: 330px; /* Cap at original size */
      max-height: 330px;
    }

    .needle {
      height: 45vw; /* Half of container width */
      max-height: 150px;
    }

    .bead {
      width: 8vw; /* Scale proportionally */
      height: 8vw;
      margin: -4vw; /* Half of bead size */
      font-size: 0.6rem; /* Smaller text */
      max-width: 30px;
      max-height: 30px;
    }

    .center-disc {
      width: 5vw;
      height: 5vw;
      max-width: 20px;
      max-height: 20px;
    }
  }
</style>

<div class="cycle-beads-container">
  <div class="beads-circle">
    <div class="center-disc"></div>
    {% for day in days_list %}
      <div
        class="bead {{ day.phase }}{% if day.is_today %} today{% endif %}"
        data-day="{{ day.day_num }}"
        title="{{ day.date|date:'F j, Y' }}"
        style="transform: rotate({{ day.angle }}deg) translate(150px) rotate(-{{ day.angle }}deg);"
      >
        {{ day.day_num }}
      </div>
    {% endfor %}
    <div class="needle"></div>
  </div>
  <div class="bead-info">
    <h4 id="selected-day">Today: {{ today|date:"F j" }}</h4>
    <p id="fertility-prob">Fertility ≈ n/a</p>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const beads = document.querySelectorAll('.bead');
    const needle = document.querySelector('.needle');
    const infoDay = document.getElementById('selected-day');
    const infoProb = document.getElementById('fertility-prob');

    function rotateTo(bead) {
      const day = +bead.dataset.day;
      const total = beads.length;
      const angle = (360 / total) * (day - 1);
      needle.style.transform = `translate(-50%, -100%) rotate(${angle + 90}deg)`;
      infoDay.textContent = `Day ${day}: ${bead.title}`;
      const peak = total / 2;
      const fert = Math.max(0, 100 - Math.abs(day - peak) * (100 / peak));
      infoProb.textContent = `Fertility ≈ ${Math.round(fert)}%`;
    }

    // Init on today
    const todayBead = document.querySelector('.bead.today');
    if (todayBead) rotateTo(todayBead);

    beads.forEach(b => {
      b.addEventListener('click', () => rotateTo(b));
      b.addEventListener('touchstart', (e) => {
        e.preventDefault();
        rotateTo(b);
      });
    });
  });
</script>
{% endblock %}