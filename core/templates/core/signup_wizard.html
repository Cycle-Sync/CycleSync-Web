{% comment %} {% load static %}
{% load i18n %}
<link rel="icon" type="image/x-icon"
     href="{% static 'img/favicon.ico' %}" />
<style>
  /* for signup */
  :root {
    /* Gradient background colors */
    --bg-start: #ffe6f0;        /* pale pink */
    --bg-end:   #ffffff;        /* white */
    --bg-angle: 145deg;         /* direction of light source */
  
    /* Neumorphic shadows */
    --shadow-light: rgba(255, 255, 255, 0.7);
    --shadow-dark:  rgba(0,   0,   0,   0.15);
    --accent:       rgba(255, 105, 180, 0.2); /* subtle pink glow */
  }
  
  /* Page background */
  body {
    background: linear-gradient(var(--bg-angle), var(--bg-start), var(--bg-end));
    font-family: sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }
  
  /* --- Login Page Styles --- */
  .neumo-container {
    background: linear-gradient(var(--bg-angle), var(--bg-start), var(--bg-end));
    padding: 2rem;
    border-radius: 2rem;
    box-shadow:
      10px 10px 20px var(--shadow-dark),
     -10px -10px 20px var(--shadow-light);
    max-width: 360px;
    width: 100%;
  }
  
  .neumo-heading {
    text-align: center;
    margin-bottom: 1.5rem;
    color: #333;
    text-shadow: 1px 1px 2px var(--shadow-light);
  }
  
  .neumo-form input {
    width: 100%;
    padding: 0.75rem;
    margin: 0.75rem 0;
    border: none;
    border-radius: 2rem;
    background: linear-gradient(var(--bg-angle), var(--bg-start), var(--bg-end));
    box-shadow:
      inset 6px 6px 8px var(--shadow-dark),
      inset -6px -6px 8px var(--shadow-light);
    font-size: 1rem;
  }
  
  .neumo-btn {
    width: 100%;
    padding: 0.75rem;
    margin-top: 1rem;
    border: none;
    border-radius: 2rem;
    background: linear-gradient(var(--bg-angle), var(--bg-start), var(--bg-end));
    box-shadow:
      6px 6px 8px var(--shadow-dark),
     -6px -6px 8px var(--shadow-light);
    font-size: 1rem;
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.2s;
  }
  
  .neumo-btn:hover {
    box-shadow:
      4px 4px 6px var(--shadow-dark),
     -4px -4px 6px var(--shadow-light),
      inset 1px 1px 2px var(--accent);
  }
  
  .neumo-btn:active {
    transform: scale(0.98);
    box-shadow:
      inset 4px 4px 6px var(--shadow-dark),
     inset -4px -4px 6px var(--shadow-light);
  }
  
  /* --- Signup Wizard Styles --- */
  #wizard-container {
    background: linear-gradient(var(--bg-angle), var(--bg-start), var(--bg-end));
    max-width: 400px;
    margin: auto;
    padding: 2rem;
    border-radius: 2rem;
    box-shadow:
      10px 10px 20px var(--shadow-dark),
     -10px -10px 20px var(--shadow-light);
  }
  
  input, select, button {
    width: 100%;
    padding: 0.75rem;
    margin-top: 1rem;
    border: none;
    border-radius: 2rem;
    background: linear-gradient(var(--bg-angle), var(--bg-start), var(--bg-end));
    box-shadow:
      inset 6px 6px 8px var(--shadow-dark),
      inset -6px -6px 8px var(--shadow-light);
    font-size: 1rem;
  }
  
  button {
    cursor: pointer;
    box-shadow:
      6px 6px 8px var(--shadow-dark),
     -6px -6px 8px var(--shadow-light);
    transition: transform 0.1s, box-shadow 0.2s;
  }
  
  button:hover {
    box-shadow:
      4px 4px 6px var(--shadow-dark),
     -4px -4px 6px var(--shadow-light),
      inset 1px 1px 2px var(--accent);
  }
  
  button:active {
    transform: scale(0.98);
    box-shadow:
      inset 4px 4px 6px var(--shadow-dark),
     inset -4px -4px 6px var(--shadow-light);
  }
  #navin {
    background: var(--bg-start);
    color: #333;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 2rem;
    cursor: pointer;
    box-shadow:
      6px 6px 8px var(--shadow-dark),
     -6px -6px 8px var(--shadow-light);
    transition: transform .1s, box-shadow .2s;
  }
  #navin:hover {
    box-shadow:
      4px 4px 6px var(--shadow-dark),
     -4px -4px 6px var(--shadow-light),
      inset 1px 1px 2px var(--accent);
  }

</style>

{% block content %}
<div id="wizard-container">
  <!-- Progress bar -->
  <div id="progress">
    {% for step_name, step_form in wizard.form_list %}
      <div class="step-indicator" data-step="{{ forloop.counter0 }}">{{ forloop.counter }}.</div>
    {% endfor %}
  </div>
  
  <form method="post">
    {% csrf_token %}
    {{ wizard.management_form }}
    {{ form.as_p }}
  
    <div class="buttons">
      {% if wizard.steps.prev %} 
        <button name="wizard_goto_step" value="{{ wizard.steps.prev }}">Previous</button>
      {% endif %}
      <button type="submit">
        {% if wizard.steps.next %}Next{% else %}Submit{% endif %}
      </button>
    </div>
    <div style="text-align: center; margin-top: 1rem;">
      {# homepage#}
      <a href="{% url 'home' %}"><button id="navin">To Homepage</button></a>
    </div>
  </form>
  
</div>

<script>
// Step navigation
const steps = document.querySelectorAll('.step');
let current = 0;
document.querySelectorAll('.next').forEach(btn => {
  btn.onclick = () => {
    if (current === 2) checkUsername();  //AJAX on username step
    else navigate(current+1);
  };
});
document.querySelectorAll('.prev').forEach(btn => {
  btn.onclick = () => navigate(current-1);
});
function navigate(idx) {
  steps[current].style.display='none';
  steps[idx].style.display='block';
  current = idx;
}

// AJAX username check (on blur or Next)
function checkUsername() {
  const usr = document.querySelector('input[name="username"]').value;
  fetch(`{% url 'validate_username' %}?username=${usr}`)
    .then(res=>res.json())
    .then(data=>{
      if (!data.available) {
        alert('Username taken!');
      } else navigate(current+1);
    });
}

// Initialize Select2 on country field
$(document).ready(() => {
  $('select[name="country"]').select2({ width: '100%' });
});
</script>
{% endblock %} {% endcomment %}

{% load static i18n %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Sign Up | CycleSync{% endblock %}</title>
  <link rel="icon" href="{% static 'img/favicon.ico' %}" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg-start:     #ffe6f0;
      --bg-end:       #ffffff;
      --bg-angle:     145deg;
      --shadow-light: rgba(255,255,255,0.7);
      --shadow-dark:  rgba(0,0,0,0.15);
      --accent:       rgba(255,105,180,0.2);
      --font-base:    clamp(1rem, 1.5vw, 1.25rem);
    }

    /* Mobile-first base */
    body {
      margin: 0; padding: 0;
      font-family: sans-serif;
      font-size: var(--font-base);                           /* Fluid typography */ :contentReference[oaicite:5]{index=5}
      background: linear-gradient(var(--bg-angle), var(--bg-start), var(--bg-end));
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh;
    }

    /* Wizard container: fluid up to max-width */
    #wizard-container {
      width: 90%;                                             /* Fluid width */ :contentReference[oaicite:6]{index=6}
      max-width: 400px;                                       /* Constrain on large screens */ :contentReference[oaicite:7]{index=7}
      padding: 2rem;
      background: linear-gradient(var(--bg-angle), var(--bg-start), var(--bg-end));
      border-radius: 2rem;
      box-shadow:
        6px 6px 16px var(--shadow-dark),
       -6px -6px 16px var(--shadow-light);                    /* Slight shadows on mobile */ :contentReference[oaicite:8]{index=8}
      margin: 1rem auto;
    }

    /* Progress indicators */
    #progress {
      display: flex; justify-content: space-between;
      margin-bottom: 1.5rem;
    }
    .step-indicator {
      flex: 1;
      text-align: center;
      font-size: 0.9rem;
      color: #666;
      position: relative;
    }
    .step-indicator::before {
      content: '';
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 1.5rem; height: 1.5rem;
      line-height: 1.5rem; border-radius: 50%;
      background: var(--bg-start);
      box-shadow:
        3px 3px 6px var(--shadow-dark),
       -3px -3px 6px var(--shadow-light);
    }

    /* Form elements */
    form input, form select, form button {
      width: 100%; padding: 0.75rem; margin: 0.75rem 0;
      font-size: var(--font-base);
      border: none; border-radius: 2rem;
      background: linear-gradient(var(--bg-angle), var(--bg-start), var(--bg-end));
      box-shadow:
        inset 4px 4px 6px var(--shadow-dark),
        inset -4px -4px 6px var(--shadow-light);              /* Soft inset shadows */ :contentReference[oaicite:9]{index=9}
    }

    form .buttons {
      display: flex; justify-content: space-between;
    }
    form .buttons button {
      width: calc(50% - 0.5rem);
      box-shadow:
        4px 4px 8px var(--shadow-dark),
       -4px -4px 8px var(--shadow-light);
      transition: transform 0.1s, box-shadow 0.2s;
    }
    form .buttons button:hover {
      box-shadow:
        2px 2px 4px var(--shadow-dark),
       -2px -2px 4px var(--shadow-light),
        inset 1px 1px 2px var(--accent);
    }
    form .buttons button:active {
      transform: scale(0.98);
    }

    /* Adjustments for tablets */
    @media (min-width: 481px) and (max-width: 768px) {
      #wizard-container { max-width: 480px; }               /* Wider on tablets */ :contentReference[oaicite:10]{index=10}
    }

    /* Heavy shadow reduction for small devices */
    @media (max-width: 480px) {
      #wizard-container {
        box-shadow:
          4px 4px 10px var(--shadow-dark),
         -4px -4px 10px var(--shadow-light);
      }
      form input, form select, form button {
        box-shadow:
          inset 3px 3px 5px var(--shadow-dark),
          inset -3px -3px 5px var(--shadow-light);
      }
    }
  </style>
</head>
<body>
  <div id="wizard-container">
    <div id="progress">
      {% for step_name, step_form in wizard.form_list %}
        <div class="step-indicator" data-step="{{ forloop.counter0 }}">{{ forloop.counter }}</div>
      {% endfor %}
    </div>

    <form method="post">
      {% csrf_token %}
      {{ wizard.management_form }}
      {{ form.as_p }}

      <div class="buttons">
        {% if wizard.steps.prev %}
          <button name="wizard_goto_step" value="{{ wizard.steps.prev }}">Previous</button>
        {% endif %}
        <button type="submit">
          {% if wizard.steps.next %}Next{% else %}Submit{% endif %}
        </button>
      </div>

      <div style="text-align:center; margin-top:1rem;">
        <a href="{% url 'home' %}">
          <button type="button">To Homepage</button>
        </a>
      </div>
    </form>
  </div>
</body>
</html>
{% endblock %}
